<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Reporting App Prototype</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Dense input styling override */
        .dense-input {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
            font-size: 0.875rem; 
            height: 2rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
        const { useState, useEffect, useMemo } = React;
        
        // --- SVGs for Icons ---
        const Icons = {
            LayoutDashboard: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></svg>,
            PenTool: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Settings: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            CheckCircle2: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            XCircle: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
            Plus: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Save: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            User: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            ArrowRight: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            BarChart3: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
            Trash2: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            ChevronDown: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>,
            Calendar: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Target: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            ShieldCheck: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>,
            AlertCircle: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Building2: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>,
            MessageSquare: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            AlertTriangle: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
            Clock: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ListTodo: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="5" width="6" height="6" rx="1"/><path d="m3 17 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/></svg>,
            Send: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Cloud: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M20 19c0-3.59-2.686-6.5-6-6.5S8 15.41 8 19"/><path d="M13 10V3"/><path d="M13 3L9 7"/><path d="M13 3l4 4"/></svg>,
            Loader2: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            TrendingUp: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        };

        const { 
            LayoutDashboard, PenTool, Settings, CheckCircle2, XCircle, Plus, Save, 
            User, ArrowRight, BarChart3, Trash2, ChevronDown, Calendar, Target, 
            ShieldCheck, AlertCircle, Building2, MessageSquare, AlertTriangle, 
            Clock, ListTodo, Send, Cloud, Loader2, TrendingUp
        } = Icons;

        // --- APP CODE ---
        const DEPARTMENTS = [
          { id: 'd1', name: 'Marketing', manager: 'sarah@company.com' },
          { id: 'd2', name: 'Engineering', manager: 'mike@company.com' },
          { id: 'd3', name: 'Sales', manager: 'jessica@company.com' }
        ];

        const VENDORS = [
          { id: 'v1', name: 'AWS' },
          { id: 'v2', name: 'Salesforce' },
          { id: 'v3', name: 'HubSpot' },
          { id: 'v4', name: 'Agency X' }
        ];

        const INITIAL_DROPDOWNS = {
          completion_reason: [{ id: '1', label: 'On Schedule' }, { id: '2', label: 'Ahead of Schedule' }],
          delay_reason: [{ id: '1', label: 'Resource Constrained' }, { id: '2', label: 'External Dependency' }],
          achievement_reason: [
            'Completed as planned',
            'Completed ahead of schedule',
            'Required extra resources',
            'Improved communication',
            'High clarity'
          ],
          achievement_impact: [
            'Improved Efficiency',
            'Reduced Costs',
            'Company Growth',
            'Strategic Feature',
            'Company Resilience',
            'Safeguarding Company'
          ],
          blocker_type: [
            'Internal dependency',
            'Waiting for 3rd party vendor',
            'Technical limitation',
            'Miscommunication',
            'Priority change'
          ]
        };

        const INITIAL_KPI_TEMPLATES = {
          'd1': [
            { id: 't1', title: 'Annual Revenue', target: '$5M', targetDate: '2023-12-31', createdAt: '2023-01-01' },
            { id: 't2', title: 'Brand Awareness', target: '40% Reach', targetDate: '2024-06-30', createdAt: '2023-06-01' }
          ],
          'd2': [
            { id: 't3', title: 'System Uptime', target: '99.99%', targetDate: '2023-12-31', createdAt: '2023-01-01' }
          ]
        };

        const INITIAL_METRIC_TEMPLATES = {
          'd1': [ 
            { id: 'm1', label: 'Weekly Leads', isTemplate: true },
            { id: 'm2', label: 'Ad Spend', isTemplate: true }
          ],
          'd2': [ 
            { id: 'm3', label: 'Bugs Closed', isTemplate: true },
            { id: 'm4', label: 'Deployment Success Rate', isTemplate: true }
          ]
        };

        const INITIAL_GOALS = [
          { 
            id: 'g1', 
            deptId: 'd1', 
            description: 'Launch Q4 Ad Campaign', 
            status: 'Planned', 
            plannedDate: '2023-11-20', 
            reason: '', 
            blockingTeams: [], 
            comment: '' 
          },
          { 
            id: 'g2', 
            deptId: 'd1', 
            description: 'Update Landing Page Copy', 
            status: 'Planned', 
            plannedDate: '2023-11-20', 
            reason: '', 
            blockingTeams: [], 
            comment: '' 
          },
          // Extra mock data for Insights charts
          { id: 'g3', deptId: 'd1', description: 'Past Goal 1', status: 'Completed', plannedDate: '2023-11-13', reason: 'Ahead of Schedule', blockingTeams: [], comment: '' },
          { id: 'g4', deptId: 'd1', description: 'Past Goal 2', status: 'Completed', plannedDate: '2023-11-13', reason: 'On Schedule', blockingTeams: [], comment: '' },
          { id: 'g5', deptId: 'd1', description: 'Past Goal 3', status: 'Not Completed', plannedDate: '2023-11-13', reason: 'Resource Constrained', blockingTeams: [], comment: '' },
        ];

        const INITIAL_REPORTS = [
            {
              id: 'r1',
              deptId: 'd1',
              weekStartDate: '2023-11-27',
              kpiGoals: [
                  { id: 't1', title: 'Annual Revenue', target: '$5M', targetDate: '2023-12-31', currentValue: '$4.2M', status: 'On Track', isTemplate: true, comment: 'Slight dip due to churn' },
                  { id: 't2', title: 'Brand Awareness', target: '40% Reach', targetDate: '2024-06-30', currentValue: '35%', status: 'At Risk', isTemplate: true }
              ],
              achievements: [
                  { id: 'a1', description: 'Launched Holiday Ads', reason: 'Completed ahead of schedule', impact: 'Company Growth', comment: 'Great team effort.' }
              ],
              blockers: [
                  { id: 'b1', description: 'Waiting on API', type: 'Internal dependency', blockedBy: 'Engineering', comment: 'Critical path.' }
              ],
              manualMetrics: [
                  { id: 'm1', label: 'Weekly Leads', value: '450', isTemplate: true}, 
                  { id: 'adhoc1', label: 'Churn', value: '1.2%', isTemplate: false}
              ],
              nextWeekGoals: [
                  { id: 'nw1', text: 'Optimize Ad Spend', impact: 'Reduced Costs' },
                  { id: 'nw2', text: 'Hire new Copywriter', impact: 'Improved Efficiency' }
              ],
              comments: [
                  { id: 'c1', author: 'CEO', role: 'CEO', text: 'Great work on the ads launch! Can we push harder on churn?', timestamp: '2 days ago' },
                  { id: 'c2', author: 'Sarah', role: 'Manager', text: 'Thanks! Yes, churn is priority #1 for next week.', timestamp: '1 day ago' }
              ]
            }
        ]; 

        function App() {
          const [activeView, setActiveView] = useState('manager');
          const [currentUser, setCurrentUser] = useState(DEPARTMENTS[0]); 
          const [reports, setReports] = useState(INITIAL_REPORTS);
          const [goals, setGoals] = useState(INITIAL_GOALS);
          const [templates, setTemplates] = useState(INITIAL_KPI_TEMPLATES);
          const [metricTemplates, setMetricTemplates] = useState(INITIAL_METRIC_TEMPLATES); 
          const [dropdowns, setDropdowns] = useState(INITIAL_DROPDOWNS);
          const [departments, setDepartments] = useState(DEPARTMENTS);
          const [vendors, setVendors] = useState(VENDORS);

          const addComment = (reportId, text, role) => {
              const newComment = {
                  id: Math.random().toString(),
                  author: role === 'CEO' ? 'CEO' : currentUser.name.split('@')[0], 
                  role: role,
                  text: text,
                  timestamp: 'Just now'
              };
              
              setReports(prev => prev.map(r => {
                  if (r.id === reportId) {
                      return { ...r, comments: [...(r.comments || []), newComment] };
                  }
                  return r;
              }));
          };

          return (
            <div className="flex h-screen bg-slate-50 font-sans text-slate-800">
              {/* Sidebar */}
              <div className="w-64 bg-slate-900 text-white flex flex-col shadow-xl flex-shrink-0">
                <div className="p-6 border-b border-slate-700">
                  <h1 className="text-xl font-bold tracking-tight">PerfReport<span className="text-blue-400">.io</span></h1>
                  <p className="text-xs text-slate-400 mt-1">Analytics Dashboard</p>
                </div>
                <nav className="flex-1 p-4 space-y-2">
                  <SidebarItem icon={<PenTool size={18} />} label="Manager Report" active={activeView === 'manager'} onClick={() => setActiveView('manager')} />
                  <SidebarItem icon={<LayoutDashboard size={18} />} label="CEO Dashboard" active={activeView === 'ceo'} onClick={() => setActiveView('ceo')} />
                  {/* NEW INSIGHTS TAB */}
                  <SidebarItem icon={<TrendingUp size={18} />} label="Insights & Trends" active={activeView === 'insights'} onClick={() => setActiveView('insights')} />
                  <SidebarItem icon={<Settings size={18} />} label="Admin Settings" active={activeView === 'admin'} onClick={() => setActiveView('admin')} />
                </nav>
                
                <div className="p-4 bg-slate-800 border-t border-slate-700">
                  <label className="text-xs uppercase text-slate-400 font-semibold mb-2 block">Simulate User:</label>
                  <select 
                    className="w-full bg-slate-700 border-none rounded text-sm p-2 text-white outline-none"
                    value={currentUser.id}
                    onChange={(e) => setCurrentUser(departments.find(d => d.id === e.target.value))}
                  >
                    {departments.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}
                  </select>
                </div>
              </div>

              <main className="flex-1 overflow-auto bg-slate-50/50 relative">
                {activeView === 'manager' && (
                  <ManagerView 
                    user={currentUser} 
                    reports={reports}
                    setReports={setReports}
                    templates={templates}
                    metricTemplates={metricTemplates} 
                    goals={goals}
                    setGoals={setGoals}
                    dropdowns={dropdowns}
                    departments={departments}
                    setDepartments={setDepartments}
                    vendors={vendors}
                    setVendors={setVendors}
                    onAddComment={addComment}
                  />
                )}
                {activeView === 'ceo' && <CEODashboard departments={departments} reports={reports} goals={goals} onAddComment={addComment} />}
                {activeView === 'insights' && <InsightsView departments={departments} reports={reports} goals={goals} />}
                {activeView === 'admin' && <AdminView departments={departments} setDepartments={setDepartments} templates={templates} setTemplates={setTemplates} dropdowns={dropdowns} setDropdowns={setDropdowns} vendors={vendors} setVendors={setVendors} metricTemplates={metricTemplates} setMetricTemplates={setMetricTemplates} />}
              </main>
            </div>
          );
        }

        // --- ManagerView (Same) ---
        function ManagerView({ user, reports, setReports, templates, metricTemplates, goals, setGoals, dropdowns, departments, setDepartments, vendors, setVendors, onAddComment }) {
          const [kpiGoals, setKpiGoals] = useState([]);
          const [isAddingKPI, setIsAddingKPI] = useState(false);
          const [newKPIData, setNewKPIData] = useState({ title: '', target: '', targetDate: '' });
          const [achievements, setAchievements] = useState([]);
          const [blockers, setBlockers] = useState([]);
          const [manualMetrics, setManualMetrics] = useState([]); 
          const [nextWeekGoals, setNextWeekGoals] = useState([]); 
          const [newGoalText, setNewGoalText] = useState('');
          const [newGoalImpact, setNewGoalImpact] = useState(''); 
          const [reportId, setReportId] = useState(null); 
          const [comments, setComments] = useState([]);
          const [saveStatus, setSaveStatus] = useState('saved'); 

          useEffect(() => {
              if (saveStatus === 'unsaved') {
                  setSaveStatus('saving');
                  const timer = setTimeout(() => { setSaveStatus('saved'); }, 1000);
                  return () => clearTimeout(timer);
              }
          }, [kpiGoals, achievements, blockers, manualMetrics, nextWeekGoals, saveStatus]);

          const markUnsaved = () => setSaveStatus('unsaved');
          const reviewableGoals = goals.filter(g => g.deptId === user.id && (g.status !== 'Cancelled'));

          useEffect(() => {
            const existing = reports.find(r => r.deptId === user.id && r.weekStartDate === '2023-11-27');
            if (existing) {
              setReportId(existing.id); 
              setKpiGoals(existing.kpiGoals || []);
              setAchievements(existing.achievements || []); 
              setBlockers(existing.blockers || []); 
              setManualMetrics(existing.manualMetrics || []);
              setNextWeekGoals(existing.nextWeekGoals || []); 
              setComments(existing.comments || []); 
            } else {
              const deptTemplates = templates[user.id] || [];
              const initializedKPIs = deptTemplates.map(t => ({ ...t, isTemplate: true, currentValue: '', status: 'On Track', comment: '' }));
              setKpiGoals(initializedKPIs);
              setAchievements([]); setBlockers([]); 
              const deptMetricTemplates = metricTemplates[user.id] || [];
              const initializedMetrics = deptMetricTemplates.map(m => ({ ...m, value: '', isTemplate: true }));
              setManualMetrics(initializedMetrics);
              setNextWeekGoals([]);
              setComments([]);
            }
          }, [user.id, reports, templates, metricTemplates]);

          const handleUpdateGoal = (goalId, updates) => { setGoals(prev => prev.map(g => g.id === goalId ? { ...g, ...updates } : g)); markUnsaved(); };
          const handleAddCustomKPI = () => { if (!newKPIData.title || !newKPIData.target) return; setKpiGoals([...kpiGoals, { id: Math.random().toString(), title: newKPIData.title, target: newKPIData.target, targetDate: newKPIData.targetDate || '2023-12-31', createdAt: new Date().toISOString().split('T')[0], isTemplate: false, currentValue: '', status: 'On Track', comment: '' }]); setIsAddingKPI(false); setNewKPIData({ title: '', target: '', targetDate: '' }); markUnsaved(); };
          const updateKPI = (id, field, value) => { setKpiGoals(kpiGoals.map(k => k.id === id ? { ...k, [field]: value } : k)); markUnsaved(); };
          const handleAddAchievement = () => { setAchievements([...achievements, { id: Math.random().toString(), description: '', reason: '', impact: '', comment: '' }]); markUnsaved(); };
          const updateAchievement = (id, field, value) => { setAchievements(achievements.map(a => a.id === id ? { ...a, [field]: value } : a)); markUnsaved(); };
          const removeAchievement = (id) => { setAchievements(achievements.filter(a => a.id !== id)); markUnsaved(); };
          const handleAddBlocker = () => { setBlockers([...blockers, { id: Math.random().toString(), description: '', type: '', blockedBy: '', comment: '' }]); markUnsaved(); };
          const updateBlocker = (id, field, value) => { if (field === 'blockedBy' && value === '__ADD_NEW__') { const newItem = prompt("Enter Name:"); if (newItem) { const currentBlocker = blockers.find(b => b.id === id); if (currentBlocker.type === 'Internal dependency') { const newDept = { id: Math.random().toString(), name: newItem, manager: 'Unassigned' }; setDepartments([...departments, newDept]); value = newItem; } else if (currentBlocker.type === 'Waiting for 3rd party vendor') { const newVendor = { id: Math.random().toString(), name: newItem }; setVendors([...vendors, newVendor]); value = newItem; } } else { return; } } setBlockers(blockers.map(b => { if (b.id !== id) return b; if (field === 'type') { return { ...b, [field]: value, blockedBy: '' }; } return { ...b, [field]: value }; })); markUnsaved(); };
          const removeBlocker = (id) => { setBlockers(blockers.filter(b => b.id !== id)); markUnsaved(); };
          const handleAddNextWeekGoal = () => { if (!newGoalText) return; setNextWeekGoals([...nextWeekGoals, { id: Math.random().toString(), text: newGoalText, impact: newGoalImpact }]); setNewGoalText(''); setNewGoalImpact(''); markUnsaved(); };
          
          const handleSubmit = () => { 
              const report = { id: reportId || Math.random().toString(), deptId: user.id, weekStartDate: '2023-11-27', kpiGoals, achievements, blockers, manualMetrics, nextWeekGoals, comments }; 
              setReports(prev => [...prev.filter(r => r.deptId !== user.id), report]); 
              alert("Report Submitted!"); 
          };
          const blockingTeamOptions = departments.filter(d => d.id !== user.id).map(d => ({ value: d.name, label: d.name }));

          return (
            <div className="p-8 max-w-full mx-auto space-y-8 pb-20"> 
              <header className="flex justify-between items-center sticky top-0 bg-slate-50/95 backdrop-blur z-10 py-4 border-b border-slate-200 -mx-8 px-8">
                <div><h2 className="text-2xl font-bold text-slate-800">Weekly Performance Report</h2><p className="text-slate-500">Week of Nov 27, 2023 • {user.name}</p></div>
                <div className="flex items-center gap-4">
                    <div className="flex items-center gap-2 text-xs font-medium text-slate-400">{saveStatus === 'saving' ? <><Loader2 size={14} className="animate-spin text-blue-500"/> Saving...</> : saveStatus === 'saved' ? <><Cloud size={14} className="text-green-500"/> Draft Saved</> : <span className="text-orange-400">Unsaved changes</span>}</div>
                    <button onClick={handleSubmit} className="bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 flex items-center gap-2 shadow-sm transition-all hover:shadow-md"><Save size={18} /> Submit Report</button>
                </div>
              </header>

              <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                   <h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><Target className="text-blue-600" size={18} /> Department KPI Goals</h3>
                   <button onClick={() => setIsAddingKPI(true)} className="text-xs font-bold text-blue-600 border border-blue-200 bg-white px-3 py-1 rounded hover:bg-blue-50">+ Add Custom Goal</button>
                </div>
                {isAddingKPI && (<div className="bg-blue-50 p-4 border-b border-blue-100 flex gap-2 items-end"><div className="flex-1"><label className="text-[10px] uppercase font-bold text-slate-400">Title</label><input className="w-full text-sm p-1.5 border rounded" value={newKPIData.title} onChange={e => setNewKPIData({...newKPIData, title: e.target.value})} /></div><div className="w-32"><label className="text-[10px] uppercase font-bold text-slate-400">Target</label><input className="w-full text-sm p-1.5 border rounded" value={newKPIData.target} onChange={e => setNewKPIData({...newKPIData, target: e.target.value})} /></div><div className="w-32"><label className="text-[10px] uppercase font-bold text-slate-400">Date</label><input type="date" className="w-full text-sm p-1.5 border rounded" value={newKPIData.targetDate} onChange={e => setNewKPIData({...newKPIData, targetDate: e.target.value})} /></div><button onClick={handleAddCustomKPI} className="bg-blue-600 text-white px-3 py-1.5 rounded text-sm font-bold">Save</button><button onClick={() => setIsAddingKPI(false)} className="text-slate-500 px-3 py-1.5 text-sm">Cancel</button></div>)}
                <table className="w-full text-sm text-left">
                    <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Goal Title</th><th className="px-4 py-2 w-32">Status</th><th className="px-4 py-2">Current Progress</th><th className="px-4 py-2">Comment</th><th className="px-4 py-2 w-10"></th></tr></thead>
                    <tbody className="divide-y divide-slate-100">{kpiGoals.map((kpi) => (<tr key={kpi.id} className="hover:bg-slate-50/50"><td className="px-4 py-2"><div className="font-medium text-slate-800">{kpi.title}</div><div className="text-[10px] text-slate-400 mt-0.5">Target: {kpi.target} • {kpi.targetDate} {kpi.isTemplate && <span className="bg-slate-100 text-slate-500 px-1 rounded ml-1 border">DEFAULT</span>}</div></td><td className="px-4 py-2"><select className={`w-full text-xs font-bold p-1 border rounded outline-none ${kpi.status === 'On Track' ? 'bg-green-50 text-green-700 border-green-200' : kpi.status === 'At Risk' ? 'bg-yellow-50 text-yellow-700 border-yellow-200' : 'bg-red-50 text-red-700 border-red-200'}`} value={kpi.status} onChange={(e) => updateKPI(kpi.id, 'status', e.target.value)}><option value="On Track">On Track</option><option value="At Risk">At Risk</option><option value="Off Track">Off Track</option></select></td><td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-blue-500 outline-none py-1 text-sm" placeholder="Enter value..." value={kpi.currentValue} onChange={(e) => updateKPI(kpi.id, 'currentValue', e.target.value)} /></td><td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-blue-500 outline-none py-1 text-sm" placeholder="Add context..." value={kpi.comment} onChange={(e) => updateKPI(kpi.id, 'comment', e.target.value)} /></td><td className="px-4 py-2 text-right">{!kpi.isTemplate && <button onClick={() => setKpiGoals(kpiGoals.filter(k => k.id !== kpi.id))} className="text-slate-300 hover:text-red-500"><Trash2 size={14}/></button>}</td></tr>))}</tbody>
                </table>
              </section>

              <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div className="p-4 border-b border-slate-200 bg-slate-50"><h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><Calendar className="text-blue-600" size={18} /> Review Last Week's Goals</h3></div>
                <table className="w-full text-sm text-left">
                    <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Goal Description</th><th className="px-4 py-2 w-40">Status</th><th className="px-4 py-2 w-1/4">Reason / Context</th><th className="px-4 py-2">Comment</th></tr></thead>
                    <tbody className="divide-y divide-slate-100">
                        {reviewableGoals.length === 0 ? (<tr><td colSpan="4" className="px-4 py-6 text-center text-slate-400 italic">No goals to review.</td></tr>) : (reviewableGoals.map(goal => (<tr key={goal.id} className="hover:bg-slate-50/50 align-top"><td className="px-4 py-2"><div className="font-medium text-slate-800">{goal.description}</div><div className="text-[10px] text-slate-400 mt-0.5">Planned: {goal.plannedDate}</div></td><td className="px-4 py-2"><select className={`w-full text-xs font-bold p-1.5 border rounded outline-none ${goal.status === 'Completed' ? 'bg-green-50 text-green-700 border-green-200' : goal.status === 'Not Completed' ? 'bg-red-50 text-red-700 border-red-200' : 'bg-white text-slate-700 border-slate-200'}`} value={goal.status} onChange={(e) => handleUpdateGoal(goal.id, { status: e.target.value })}><option value="Planned">Select Status...</option><option value="Completed">Completed</option><option value="Completed with Issues">Completed (Issues)</option><option value="Not Completed">Not Completed</option><option value="Cancelled">Cancelled</option></select></td><td className="px-4 py-2">{goal.status === 'Completed' && (<select className="w-full text-xs border border-green-200 rounded p-1 bg-green-50/50 outline-none text-green-800" value={goal.reason} onChange={(e) => handleUpdateGoal(goal.id, { reason: e.target.value })}><option value="">Select Factor...</option>{dropdowns.completion_reason.map(r => <option key={r.id} value={r.label}>{r.label}</option>)}</select>)}{goal.status === 'Not Completed' && (<div className="space-y-1"><select className="w-full text-xs border border-red-200 rounded p-1 bg-red-50/50 outline-none text-red-800" value={goal.reason} onChange={(e) => handleUpdateGoal(goal.id, { reason: e.target.value })}><option value="">Select Reason...</option>{dropdowns.delay_reason.map(r => <option key={r.id} value={r.label}>{r.label}</option>)}</select><div className="flex items-center gap-1"><span className="text-[10px] uppercase font-bold text-slate-400 whitespace-nowrap">Blocker:</span><div className="flex-1"><MultiSelect options={blockingTeamOptions} selected={goal.blockingTeams || []} onChange={(val) => handleUpdateGoal(goal.id, { blockingTeams: val })} placeholder="Select..." /></div></div></div>)}</td><td className="px-4 py-2"><input className="w-full text-sm border border-slate-200 rounded p-1.5 focus:border-blue-500 outline-none" placeholder="Add notes..." value={goal.comment || ''} onChange={(e) => handleUpdateGoal(goal.id, { comment: e.target.value })} /></td></tr>)))}
                    </tbody>
                </table>
              </section>

              <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50"><h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><CheckCircle2 className="text-green-600" size={18} /> Additional Achievements / Highlights</h3><button onClick={handleAddAchievement} className="text-xs font-bold text-green-600 border border-green-200 bg-white px-3 py-1 rounded hover:bg-green-50">+ Add Item</button></div>
                <table className="w-full text-sm text-left">
                    <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Description</th><th className="px-4 py-2 w-1/5">Reason</th><th className="px-4 py-2 w-1/5">Impact</th><th className="px-4 py-2">Comment</th><th className="px-4 py-2 w-10"></th></tr></thead>
                    <tbody className="divide-y divide-slate-100">
                        {achievements.map((item) => (
                            <tr key={item.id} className="hover:bg-slate-50/50">
                                <td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-green-500 outline-none py-1 text-sm" placeholder="What did you achieve?" value={item.description} onChange={(e) => updateAchievement(item.id, 'description', e.target.value)} /></td>
                                <td className="px-4 py-2"><select className="w-full text-xs border border-slate-200 rounded p-1 outline-none focus:border-green-500 bg-white" value={item.reason} onChange={(e) => updateAchievement(item.id, 'reason', e.target.value)}><option value="">Select...</option>{dropdowns.achievement_reason.map(r => <option key={r} value={r}>{r}</option>)}</select></td>
                                <td className="px-4 py-2"><select className="w-full text-xs border border-slate-200 rounded p-1 outline-none focus:border-green-500 bg-white text-green-700 font-medium" value={item.impact} onChange={(e) => updateAchievement(item.id, 'impact', e.target.value)}><option value="">Select Impact...</option>{dropdowns.achievement_impact.map(r => <option key={r} value={r}>{r}</option>)}</select></td>
                                <td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-green-500 outline-none py-1 text-sm" placeholder="Context..." value={item.comment} onChange={(e) => updateAchievement(item.id, 'comment', e.target.value)} /></td>
                                <td className="px-4 py-2 text-right"><button onClick={() => removeAchievement(item.id)} className="text-slate-300 hover:text-red-500"><Trash2 size={14}/></button></td>
                            </tr>
                        ))}
                        {achievements.length === 0 && <tr><td colSpan="5" className="px-4 py-6 text-center text-slate-400 italic">No additional achievements logged.</td></tr>}
                    </tbody>
                </table>
              </section>

              <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50"><h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><XCircle className="text-red-600" size={18} /> Blockers</h3><button onClick={handleAddBlocker} className="text-xs font-bold text-red-600 border border-red-200 bg-white px-3 py-1 rounded hover:bg-red-50">+ Add Blocker</button></div>
                <table className="w-full text-sm text-left">
                    <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Description</th><th className="px-4 py-2 w-1/5">Type</th><th className="px-4 py-2 w-1/5">Dependency</th><th className="px-4 py-2">Comment</th><th className="px-4 py-2 w-10"></th></tr></thead>
                    <tbody className="divide-y divide-slate-100">
                        {blockers.map((item) => (
                            <tr key={item.id} className="hover:bg-slate-50/50">
                                <td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-red-500 outline-none py-1 text-sm" placeholder="What blocked you?" value={item.description} onChange={(e) => updateBlocker(item.id, 'description', e.target.value)} /></td>
                                <td className="px-4 py-2"><select className="w-full text-xs border border-slate-200 rounded p-1 outline-none focus:border-red-500 bg-white" value={item.type} onChange={(e) => updateBlocker(item.id, 'type', e.target.value)}><option value="">Select Type...</option>{dropdowns.blocker_type.map(t => <option key={t} value={t}>{t}</option>)}</select></td>
                                <td className="px-4 py-2">{item.type === 'Internal dependency' ? (<select className="w-full text-xs border border-slate-200 rounded p-1 outline-none focus:border-red-500 bg-white font-medium" value={item.blockedBy} onChange={(e) => updateBlocker(item.id, 'blockedBy', e.target.value)}><option value="">Which Team?</option>{departments.filter(d => d.id !== user.id).map(d => <option key={d.id} value={d.name}>{d.name}</option>)}<option value="__ADD_NEW__" className="font-bold text-blue-600">+ Add New</option></select>) : item.type === 'Waiting for 3rd party vendor' ? (<select className="w-full text-xs border border-slate-200 rounded p-1 outline-none focus:border-red-500 bg-white font-medium" value={item.blockedBy} onChange={(e) => updateBlocker(item.id, 'blockedBy', e.target.value)}><option value="">Which Vendor?</option>{vendors.map(v => <option key={v.id} value={v.name}>{v.name}</option>)}<option value="__ADD_NEW__" className="font-bold text-blue-600">+ Add New</option></select>) : (<span className="text-slate-300 italic text-xs">N/A</span>)}</td>
                                <td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-red-500 outline-none py-1 text-sm" placeholder="Details..." value={item.comment} onChange={(e) => updateBlocker(item.id, 'comment', e.target.value)} /></td>
                                <td className="px-4 py-2 text-right"><button onClick={() => removeBlocker(item.id)} className="text-slate-300 hover:text-red-500"><Trash2 size={14}/></button></td>
                            </tr>
                        ))}
                        {blockers.length === 0 && <tr><td colSpan="5" className="px-4 py-6 text-center text-slate-400 italic">No blockers reported.</td></tr>}
                    </tbody>
                </table>
              </section>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  {/* 5. METRICS TABLE */}
                  <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                    <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50"><h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><BarChart3 className="text-slate-600" size={18} /> Key Metrics</h3><button onClick={() => setManualMetrics([...manualMetrics, {id: Math.random().toString(), label:'', value:'', isTemplate: false}])} className="text-xs font-bold text-slate-600 border border-slate-200 bg-white px-3 py-1 rounded hover:bg-slate-100">+ Custom</button></div>
                    <table className="w-full text-sm text-left">
                        <thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-2/3">Metric Name</th><th className="px-4 py-2 w-1/3">Value</th><th className="px-4 py-2 w-10"></th></tr></thead>
                        <tbody className="divide-y divide-slate-100">
                            {manualMetrics.map((m, i) => (<tr key={i} className="hover:bg-slate-50/50"><td className="px-4 py-2">{m.isTemplate ? (<div className="font-medium text-slate-600 flex items-center gap-2"><ShieldCheck size={14} className="text-slate-400"/> {m.label}</div>) : (<input className="w-full bg-transparent border-b border-transparent focus:border-blue-300 outline-none font-medium" placeholder="Metric Name" value={m.label} onChange={(e) => { const update = [...manualMetrics]; update[i].label = e.target.value; setManualMetrics(update); }} />)}</td><td className="px-4 py-2"><input className="w-full bg-transparent border-b border-transparent focus:border-blue-300 outline-none font-bold text-slate-800" placeholder="0" value={m.value} onChange={(e) => { const update = [...manualMetrics]; update[i].value = e.target.value; setManualMetrics(update); }} /></td><td className="px-4 py-2 text-right">{!m.isTemplate && <button onClick={() => setManualMetrics(manualMetrics.filter((_, idx) => idx !== i))} className="text-slate-300 hover:text-red-500"><Trash2 size={14}/></button>}</td></tr>))}
                        </tbody>
                    </table>
                  </section>

                  {/* 6. NEXT WEEK TABLE */}
                  <section className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                    <div className="p-4 border-b border-slate-200 bg-slate-50"><h3 className="text-base font-bold text-slate-800 flex items-center gap-2"><ArrowRight className="text-purple-600" size={18} /> Next Week's Plan</h3></div>
                    <div className="p-3 bg-white border-b border-slate-100 flex gap-2 items-center">
                        <input className="flex-1 text-sm border border-slate-300 rounded p-1.5 focus:border-purple-500 outline-none" placeholder="Add new goal..." value={newGoalText} onChange={e => setNewGoalText(e.target.value)} onKeyDown={e => {if(e.key === 'Enter') handleAddNextWeekGoal()}} />
                        <select className="w-32 text-sm border border-slate-300 rounded p-1.5 focus:border-purple-500 outline-none" value={newGoalImpact} onChange={e => setNewGoalImpact(e.target.value)}><option value="">Impact...</option>{dropdowns.achievement_impact.map(i => <option key={i} value={i}>{i}</option>)}</select>
                        <button onClick={handleAddNextWeekGoal} className="bg-purple-600 text-white px-3 rounded text-sm font-bold hover:bg-purple-700 py-1.5">Add</button>
                    </div>
                    <table className="w-full text-sm text-left">
                        <tbody className="divide-y divide-slate-100">
                            {nextWeekGoals.map(g => (<tr key={g.id} className="hover:bg-slate-50/50"><td className="px-4 py-2 font-medium text-slate-700 border-l-4 border-l-purple-500 pl-3"><div className="flex justify-between"><span>{g.text}</span>{g.impact && <span className="text-[10px] bg-purple-50 text-purple-700 px-1.5 py-0.5 rounded border border-purple-200">{g.impact}</span>}</div></td><td className="px-4 py-2 text-right w-10"><button onClick={() => removeNextWeekGoal(g.id)} className="text-slate-300 hover:text-red-500"><Trash2 size={14}/></button></td></tr>))}
                            {nextWeekGoals.length === 0 && <tr><td colSpan="2" className="px-4 py-6 text-center text-slate-400 italic">No goals added yet.</td></tr>}
                        </tbody>
                    </table>
                  </section>
              </div>

              <section className="bg-slate-50 rounded-xl border border-slate-200 p-6 mt-8">
                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><MessageSquare className="text-purple-600" size={22} /> CEO Feedback</h3>
                <CommentThread comments={comments} onAdd={(text) => onAddComment(reportId, text, 'Manager')} />
              </section>
            </div>
          );
        }

        // --- NEW: INSIGHTS VIEW (Analytics) ---
        function InsightsView({ departments, reports, goals }) {
            const [selectedDateRange, setSelectedDateRange] = useState('All Time');
            
            // Mock aggregations based on 'goals' and 'reports'
            // In a real app, these would be backend queries
            
            // 1. Success Analysis (Goals Completed + Additional Achievements)
            const completedGoals = goals.filter(g => g.status === 'Completed');
            // Mock additional achievements from all reports
            const allAchievements = reports.flatMap(r => r.achievements || []);
            
            // Aggregate Reasons for Success
            const successReasons = {};
            completedGoals.forEach(g => { successReasons[g.reason] = (successReasons[g.reason] || 0) + 1; });
            allAchievements.forEach(a => { successReasons[a.reason] = (successReasons[a.reason] || 0) + 1; });

            // 2. Failure Analysis (Goals Not Completed)
            const failedGoals = goals.filter(g => g.status === 'Not Completed');
            const failureReasons = {};
            failedGoals.forEach(g => { failureReasons[g.reason] = (failureReasons[g.reason] || 0) + 1; });
            
            const totalSuccess = completedGoals.length + allAchievements.length;
            const totalFailure = failedGoals.length;

            return (
                <div className="p-8 max-w-full mx-auto space-y-8">
                    <header className="flex justify-between items-center mb-8">
                        <div><h2 className="text-2xl font-bold text-slate-800">Insights & Trends</h2><p className="text-slate-500">Analyze performance factors over time.</p></div>
                        <div className="flex items-center gap-2 bg-white border border-slate-200 rounded-lg px-3 py-2 shadow-sm"><Calendar size={16} className="text-slate-400" /><span className="text-xs font-bold uppercase text-slate-400">Timeframe</span><select className="text-sm font-bold text-slate-800 bg-transparent outline-none cursor-pointer" value={selectedDateRange} onChange={(e) => setSelectedDateRange(e.target.value)}><option>Last 30 Days</option><option>Last Quarter</option><option>All Time</option></select></div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* SUCCESS ANALYSIS */}
                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                            <h3 className="text-lg font-bold text-green-700 mb-6 flex items-center gap-2"><CheckCircle2 size={20}/> Success Analysis <span className="text-sm font-normal text-slate-400 ml-auto">{totalSuccess} Items</span></h3>
                            
                            {/* Simple Bar Chart Visualization using HTML/CSS */}
                            <div className="space-y-4">
                                {Object.keys(successReasons).map(reason => {
                                    const count = successReasons[reason];
                                    const pct = Math.round((count / totalSuccess) * 100) || 0;
                                    return (
                                        <div key={reason}>
                                            <div className="flex justify-between text-sm mb-1"><span className="font-medium text-slate-700">{reason}</span><span className="text-slate-500">{count} ({pct}%)</span></div>
                                            <div className="w-full bg-slate-100 rounded-full h-2.5"><div className="bg-green-500 h-2.5 rounded-full" style={{ width: `${pct}%` }}></div></div>
                                        </div>
                                    )
                                })}
                                {totalSuccess === 0 && <div className="text-center text-slate-400 italic">No data available for this period.</div>}
                            </div>
                        </div>

                        {/* FAILURE ANALYSIS */}
                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                            <h3 className="text-lg font-bold text-red-700 mb-6 flex items-center gap-2"><XCircle size={20}/> Delay Analysis <span className="text-sm font-normal text-slate-400 ml-auto">{totalFailure} Items</span></h3>
                             <div className="space-y-4">
                                {Object.keys(failureReasons).map(reason => {
                                    const count = failureReasons[reason];
                                    const pct = Math.round((count / totalFailure) * 100) || 0;
                                    return (
                                        <div key={reason}>
                                            <div className="flex justify-between text-sm mb-1"><span className="font-medium text-slate-700">{reason}</span><span className="text-slate-500">{count} ({pct}%)</span></div>
                                            <div className="w-full bg-slate-100 rounded-full h-2.5"><div className="bg-red-500 h-2.5 rounded-full" style={{ width: `${pct}%` }}></div></div>
                                        </div>
                                    )
                                })}
                                {totalFailure === 0 && <div className="text-center text-slate-400 italic">No data available for this period.</div>}
                            </div>
                        </div>
                    </div>
                </div>
            )
        }

        // --- CEODashboard & AdminView & Utils (Same as before, checking labels) ---
        
        function CEODashboard({ departments, reports, goals, onAddComment }) {
          const [selectedWeek, setSelectedWeek] = useState('2023-11-27');
          const [selectedDeptId, setSelectedDeptId] = useState(null);
          const weekReports = reports.filter(r => r.weekStartDate === selectedWeek);
          const submittedCount = weekReports.length;
          const submissionRate = Math.round((submittedCount / departments.length) * 100);
          const redFlags = weekReports.reduce((acc, r) => acc + (r.kpiGoals || []).filter(k => k.status === 'Off Track').length, 0);
          const selectedDept = departments.find(d => d.id === selectedDeptId);
          const selectedReport = weekReports.find(r => r.deptId === selectedDeptId);
          const selectedGoalsReview = goals.filter(g => g.deptId === selectedDeptId && g.plannedDate === '2023-11-20'); 
          const activeBlockersCount = weekReports.reduce((acc, r) => { if (Array.isArray(r.blockers)) return acc + r.blockers.length; return acc + (r.blockers ? 1 : 0); }, 0);

          return (
            <div className="p-8 max-w-full mx-auto h-full flex flex-col relative">
              <header className="mb-8 flex justify-between items-end">
                <div><h2 className="text-3xl font-bold text-slate-800 tracking-tight">Executive Dashboard</h2><p className="text-slate-500 mt-1">Performance Overview & KPI Health</p></div>
                <div className="flex items-center gap-2 bg-white border border-slate-200 rounded-lg px-3 py-2 shadow-sm"><Calendar size={16} className="text-slate-400" /><span className="text-xs font-bold uppercase text-slate-400">Week Of</span><select className="text-sm font-bold text-slate-800 bg-transparent outline-none cursor-pointer" value={selectedWeek} onChange={(e) => { setSelectedWeek(e.target.value); setSelectedDeptId(null); }} ><option value="2023-11-27">Nov 27, 2023</option></select></div>
              </header>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><StatCard title="Submission Rate" value={`${submissionRate}%`} sub={`${submittedCount}/${departments.length} Departments`} color="blue" icon={<CheckCircle2 className="text-blue-500" />} /><StatCard title="KPIs Off Track" value={redFlags} sub="Requires Attention" color="red" icon={<AlertCircle className="text-red-500" />} /><StatCard title="Active Blockers" value={activeBlockersCount} sub="Reported this week" color="orange" icon={<XCircle className="text-orange-500" />} /></div>
              <div className="flex-1 min-h-0 relative"><div className="absolute inset-0 overflow-auto pb-10 pr-2"><div className="grid grid-cols-1 gap-4">{departments.map(dept => { const report = weekReports.find(r => r.deptId === dept.id); const kpis = report ? (report.kpiGoals || []) : []; return (<div key={dept.id} onClick={() => setSelectedDeptId(dept.id)} className={`bg-white rounded-xl border p-5 cursor-pointer transition-all hover:shadow-md ${selectedDeptId === dept.id ? 'border-blue-500 ring-1 ring-blue-500' : 'border-slate-200'}`}><div className="flex justify-between items-start mb-4"><div><h3 className="font-bold text-lg text-slate-800">{dept.name}</h3><div className="text-xs text-slate-500 flex items-center gap-1 mt-1"><User size={12}/> {dept.manager}</div></div>{report ? (<span className="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1"><CheckCircle2 size={12}/> Submitted</span>) : (<span className="bg-slate-100 text-slate-500 text-xs font-bold px-2 py-1 rounded-full">Pending</span>)}</div>{kpis.length > 0 ? (<div className="grid grid-cols-1 md:grid-cols-3 gap-3">{kpis.map((kpi, i) => (<div key={i} className="flex items-center gap-2 p-2 rounded bg-slate-50 border border-slate-100"><div className={`w-2 h-2 rounded-full flex-shrink-0 ${kpi.status === 'On Track' ? 'bg-green-500' : kpi.status === 'At Risk' ? 'bg-yellow-500' : 'bg-red-500'}`} /><div className="min-w-0"><div className="text-xs font-semibold truncate text-slate-700">{kpi.title}</div><div className="text-[10px] text-slate-500">{kpi.currentValue || 'No Data'}</div></div></div>))}</div>) : (<div className="text-xs text-slate-400 italic py-2">No KPI data available.</div>)}</div>); })}</div></div>{selectedDeptId && (<><div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm z-10 transition-opacity" onClick={() => setSelectedDeptId(null)} /><div className="fixed top-0 right-0 h-full w-[800px] bg-white border-l border-slate-200 shadow-2xl flex flex-col z-50 animate-in slide-in-from-right duration-300"><div className="p-5 border-b border-slate-100 bg-slate-50 flex justify-between items-center"><div><h3 className="font-bold text-xl text-slate-800">{selectedDept.name}</h3><div className="text-xs text-slate-500 flex items-center gap-1 mt-1"><span className="uppercase font-bold tracking-wider text-slate-400">Weekly Report</span><span className="w-1 h-1 bg-slate-400 rounded-full"></span>{selectedWeek}</div></div><button onClick={() => setSelectedDeptId(null)} className="p-2 hover:bg-slate-200 rounded-full transition-colors text-slate-500"><XCircle size={24}/></button></div><div className="flex-1 overflow-auto p-8 space-y-8 bg-white flex flex-col">{!selectedReport ? (<div className="h-full flex flex-col items-center justify-center text-slate-400"><div className="bg-slate-50 p-4 rounded-full mb-3"><AlertCircle size={32} className="opacity-50"/></div><p>Report not submitted for this week.</p></div>) : (<><div className="space-y-8 flex-1"><section><h4 className="text-xs uppercase font-bold text-slate-400 mb-3 flex items-center gap-2"><Target size={14}/> KPI Progress</h4><div className="grid grid-cols-2 gap-3">{(selectedReport.kpiGoals || []).map((kpi, i) => (<div key={i} className="p-3 rounded-lg border border-slate-100 bg-slate-50/50"><div className="flex justify-between items-center mb-2"><span className="font-semibold text-sm text-slate-700">{kpi.title}</span><StatusBadge status={kpi.status} /></div><div className="flex items-center gap-4 text-xs text-slate-600 mb-2"><div className="flex flex-col"><span className="text-[10px] uppercase text-slate-400 font-bold">Target</span><span>{kpi.target}</span></div><div className="w-px h-6 bg-slate-200"></div><div className="flex flex-col"><span className="text-[10px] uppercase text-slate-400 font-bold">Actual</span><span className="font-medium text-slate-900">{kpi.currentValue}</span></div></div>{kpi.comment && <div className="text-xs italic text-slate-500 bg-white p-2 rounded border border-slate-100">"{kpi.comment}"</div>}</div>))}</div></section><section><h4 className="text-xs uppercase font-bold text-blue-600 mb-3 flex items-center gap-2"><Clock size={14}/> Last Week's Goal Review</h4><div className="border border-slate-200 rounded-lg overflow-hidden"><table className="w-full text-sm text-left"><thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Goal Description</th><th className="px-4 py-2 w-24">Status</th><th className="px-4 py-2 w-1/4">Reason</th><th className="px-4 py-2">Comment</th></tr></thead><tbody className="divide-y divide-slate-100">{selectedGoalsReview.length === 0 ? (<tr><td colSpan="4" className="px-4 py-6 text-center text-slate-400 italic">No goals reviewed.</td></tr>) : (selectedGoalsReview.map(g => (<tr key={g.id} className="hover:bg-slate-50/50"><td className="px-4 py-3 font-medium text-slate-800">{g.description}</td><td className="px-4 py-3"><span className={`text-[10px] uppercase font-bold px-2 py-0.5 rounded ${g.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{g.status}</span></td><td className="px-4 py-3 text-slate-600 text-xs">{g.reason || '-'}</td><td className="px-4 py-3 text-slate-500 text-xs italic">{g.comment || '-'}</td></tr>)))}</tbody></table></div></section><section><h4 className="text-xs uppercase font-bold text-green-600 mb-3 flex items-center gap-2"><CheckCircle2 size={14}/> Additional Achievements / Highlights</h4><div className="border border-slate-200 rounded-lg overflow-hidden"><table className="w-full text-sm text-left"><thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Description</th><th className="px-4 py-2 w-1/4">Reason</th><th className="px-4 py-2 w-1/4">Impact</th><th className="px-4 py-2">Comment</th></tr></thead><tbody className="divide-y divide-slate-100">{Array.isArray(selectedReport.achievements) && selectedReport.achievements.length > 0 ? (selectedReport.achievements.map(a => (<tr key={a.id} className="hover:bg-slate-50/50"><td className="px-4 py-3 font-medium text-slate-800">{a.description}</td><td className="px-4 py-3"><span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-green-50 border border-green-200 text-green-700 uppercase">{a.reason}</span></td><td className="px-4 py-3"><span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-blue-50 border border-blue-200 text-blue-700 uppercase">{a.impact || '-'}</span></td><td className="px-4 py-3 text-slate-500 text-xs italic">{a.comment || '-'}</td></tr>))) : (<tr><td colSpan="4" className="px-4 py-6 text-center text-slate-400 italic">No achievements logged.</td></tr>)}</tbody></table></div></section><section><h4 className="text-xs uppercase font-bold text-red-600 mb-3 flex items-center gap-2"><XCircle size={14}/> Blockers</h4><div className="border border-slate-200 rounded-lg overflow-hidden"><table className="w-full text-sm text-left"><thead className="bg-slate-50 text-slate-500 font-semibold border-b border-slate-200"><tr><th className="px-4 py-2 w-1/3">Description</th><th className="px-4 py-2 w-1/4">Type</th><th className="px-4 py-2 w-1/4">Dependency</th><th className="px-4 py-2">Comment</th></tr></thead><tbody className="divide-y divide-slate-100">{Array.isArray(selectedReport.blockers) && selectedReport.blockers.length > 0 ? (selectedReport.blockers.map(b => (<tr key={b.id} className="hover:bg-slate-50/50"><td className="px-4 py-3 font-medium text-slate-800">{b.description}</td><td className="px-4 py-3"><span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-red-50 border border-red-200 text-red-700 uppercase">{b.type}</span></td><td className="px-4 py-3 text-xs text-slate-700 font-medium">{b.blockedBy ? <span className="flex items-center gap-1"><AlertTriangle size={10} className="text-orange-500"/> {b.blockedBy}</span> : '-'}</td><td className="px-4 py-3 text-slate-500 text-xs italic">{b.comment || '-'}</td></tr>))) : (<tr><td colSpan="4" className="px-4 py-6 text-center text-slate-400 italic">No blockers logged.</td></tr>)}</tbody></table></div></section>{(selectedReport.manualMetrics || []).length > 0 && (<section><h4 className="text-xs uppercase font-bold text-slate-400 mb-3 flex items-center gap-2"><BarChart3 size={14}/> Key Metrics</h4><div className="grid grid-cols-3 gap-3">{selectedReport.manualMetrics.map((m, i) => (<div key={i} className="bg-white p-3 rounded border border-slate-200 text-center shadow-sm"><div className="text-[10px] uppercase text-slate-400 font-bold mb-1">{m.label}</div><div className="font-bold text-lg text-slate-800">{m.value}</div></div>))}</div></section>)}{(selectedReport.nextWeekGoals || []).length > 0 && (<section><h4 className="text-xs uppercase font-bold text-purple-600 mb-3 flex items-center gap-2"><ListTodo size={14}/> Next Week's Plan</h4><ul className="space-y-2">{selectedReport.nextWeekGoals.map(g => (<li key={g.id} className="text-sm p-2 bg-purple-50 border border-purple-100 rounded flex items-center gap-2 justify-between"><div><div className="w-1.5 h-1.5 rounded-full bg-purple-500 inline-block mr-2"></div><span className="font-medium text-slate-700">{g.text}</span></div>{g.impact && <span className="text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded border border-purple-200">{g.impact}</span>}</li>))}</ul></section>)}</div><div className="pt-6 mt-6 border-t border-slate-100 bg-white"><h4 className="text-xs uppercase font-bold text-purple-600 mb-3 flex items-center gap-2"><MessageSquare size={14}/> CEO Feedback Thread</h4><CommentThread comments={selectedReport.comments} onAdd={(text) => onAddComment(selectedReport.id, text, 'CEO')} /></div></>)}</div></div></>)}</div></div>
          );
        }

        // --- AdminView & Utils (Same) ---
        function AdminView({ departments, setDepartments, templates, setTemplates, dropdowns, setDropdowns, vendors, setVendors, metricTemplates, setMetricTemplates }) { const [activeTab, setActiveTab] = useState('templates'); const [selectedDeptId, setSelectedDeptId] = useState(departments[0]?.id); const currentTemplates = templates[selectedDeptId] || []; const handleAddTemplate = () => { const newTemplate = { id: Math.random().toString(), title: 'New KPI Goal', target: 'Target Value', targetDate: '2023-12-31', createdAt: new Date().toISOString().split('T')[0] }; setTemplates({ ...templates, [selectedDeptId]: [...currentTemplates, newTemplate] }); }; const deleteTemplate = (id) => { const updatedList = currentTemplates.filter(t => t.id !== id); setTemplates({ ...templates, [selectedDeptId]: updatedList }); }; const updateTemplate = (id, field, value) => { const updatedList = currentTemplates.map(t => t.id === id ? { ...t, [field]: value } : t); setTemplates({ ...templates, [selectedDeptId]: updatedList }); }; const [newVendorName, setNewVendorName] = useState(''); const handleAddVendor = () => { if(newVendorName) { setVendors([...vendors, { id: Math.random().toString(), name: newVendorName }]); setNewVendorName(''); } }; return (<div className="p-8 max-w-full mx-auto"><header className="mb-8"><h2 className="text-2xl font-bold text-slate-800">System Configuration</h2><p className="text-slate-500">Manage Departments, Templates, and Dropdowns</p></header><div className="flex gap-1 bg-slate-200 p-1 rounded-lg inline-flex mb-8"><button onClick={() => setActiveTab('departments')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'departments' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Departments</button><button onClick={() => setActiveTab('vendors')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'vendors' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Vendors</button><button onClick={() => setActiveTab('templates')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'templates' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>KPI Templates</button><button onClick={() => setActiveTab('dropdowns')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === 'dropdowns' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>Dropdowns</button></div>{activeTab === 'departments' && (<div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden p-6"><h3 className="text-lg font-bold text-slate-800 mb-4">Department Management</h3><table className="w-full text-sm text-left"><thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-200"><tr><th className="px-4 py-2">Name</th><th className="px-4 py-2">Manager Email</th></tr></thead><tbody>{departments.map(d => (<tr key={d.id} className="border-b border-slate-50"><td className="px-4 py-3">{d.name}</td><td className="px-4 py-3 text-slate-500">{d.manager}</td></tr>))}</tbody></table></div>)}{activeTab === 'vendors' && (<div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden p-6"><h3 className="text-lg font-bold text-slate-800 mb-4">Vendor Management</h3><div className="flex gap-2 mb-6 max-w-md"><input className="flex-1 border rounded px-3 py-2 text-sm" placeholder="New Vendor Name..." value={newVendorName} onChange={e => setNewVendorName(e.target.value)} /><button onClick={handleAddVendor} className="bg-slate-800 text-white px-4 py-2 rounded text-sm font-bold">Add</button></div><table className="w-full text-sm text-left"><thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-200"><tr><th className="px-4 py-2">Vendor Name</th><th className="px-4 py-2 text-right">Actions</th></tr></thead><tbody>{vendors.map(v => (<tr key={v.id} className="border-b border-slate-50"><td className="px-4 py-3">{v.name}</td><td className="px-4 py-3 text-right text-slate-400 hover:text-red-500 cursor-pointer">Delete</td></tr>))}</tbody></table></div>)}{activeTab === 'templates' && (<div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6"><div className="flex justify-between items-center mb-6"><h3 className="text-lg font-bold text-slate-800">KPI Templates</h3><select className="bg-slate-50 border border-slate-200 rounded px-2 py-1 text-sm font-bold" value={selectedDeptId} onChange={e => setSelectedDeptId(e.target.value)}>{departments.map(d => <option key={d.id} value={d.id}>{d.name}</option>)}</select></div><div className="space-y-3">{currentTemplates.map(t => (<div key={t.id} className="grid grid-cols-12 gap-4 items-center px-3 py-3 border border-slate-200 rounded bg-slate-50"><div className="col-span-4"><input className="w-full text-sm bg-transparent font-medium" value={t.title} onChange={e => updateTemplate(t.id, 'title', e.target.value)} /></div><div className="col-span-3"><input className="w-full text-sm bg-transparent" value={t.target} onChange={e => updateTemplate(t.id, 'target', e.target.value)} /></div><div className="col-span-3"><input type="date" className="w-full text-sm bg-transparent" value={t.targetDate} onChange={e => updateTemplate(t.id, 'targetDate', e.target.value)} /></div><div className="col-span-2 text-right"><button onClick={() => deleteTemplate(t.id)}><Trash2 size={16} className="text-slate-400 hover:text-red-500"/></button></div></div>))}</div><button onClick={handleAddTemplate} className="mt-4 text-sm text-blue-600 font-medium flex items-center gap-1">+ Add KPI</button></div>)}{activeTab === 'dropdowns' && (<div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6"><h3 className="text-lg font-bold text-slate-800 mb-4">Achievement Reasons</h3><div className="flex flex-wrap gap-2 mb-6">{dropdowns.achievement_reason.map(r => (<span key={r} className="bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-medium border border-green-200">{r}</span>))}</div></div>)}</div>); }
        function SidebarItem({ icon, label, active, onClick }) { return (<button onClick={onClick} className={`w-full flex items-center gap-3 px-3 py-2 rounded-md transition-all text-sm font-medium ${active ? 'bg-blue-600 text-white shadow-md' : 'text-slate-300 hover:bg-slate-800 hover:text-white'}`}>{icon} {label}</button>); }
        function MultiSelect({ options, selected, onChange, placeholder }) { const [isOpen, setIsOpen] = useState(false); const toggleOption = (value) => { if (selected.includes(value)) onChange(selected.filter(item => item !== value)); else onChange([...selected, value]); }; return (<div className="relative"><div className="w-full border border-slate-300 rounded-md text-sm p-2 bg-white min-h-[38px] cursor-pointer flex flex-wrap gap-1 items-center focus:ring-1 focus:ring-blue-500" onClick={() => setIsOpen(!isOpen)}>{selected.length === 0 && <span className="text-slate-400 italic">{placeholder}</span>}{selected.map(item => (<span key={item} className="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded-full flex items-center gap-1 font-medium">{item} <span className="hover:text-red-950 font-bold px-0.5" onClick={(e) => { e.stopPropagation(); toggleOption(item); }}>×</span></span>))}<div className="ml-auto text-slate-400"><ChevronDown size={14} /></div></div>{isOpen && (<><div className="fixed inset-0 z-10" onClick={() => setIsOpen(false)} /><div className="absolute z-20 w-full bg-white border border-slate-200 shadow-xl rounded-md mt-1 max-h-48 overflow-auto animate-in fade-in zoom-in-95 duration-100">{options.map(opt => (<div key={opt.value} className="p-2 hover:bg-slate-50 cursor-pointer flex items-center gap-2 text-sm border-b border-slate-50 last:border-none text-slate-700" onClick={() => toggleOption(opt.value)}><div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${selected.includes(opt.value) ? 'bg-red-500 border-red-500' : 'border-slate-300'}`}>{selected.includes(opt.value) && <CheckCircle2 size={10} className="text-white" />}</div>{opt.label}</div>))}</div></>)}</div>); }
        function StatCard({ title, value, sub, color, icon }) { const colors = { blue: "border-l-blue-500", red: "border-l-red-500", orange: "border-l-orange-500", green: "border-l-green-500" }; return (<div className={`bg-white p-5 rounded-lg border border-slate-200 shadow-sm border-l-4 ${colors[color] || colors.blue}`}><div className="flex justify-between items-start mb-2"><h4 className="text-slate-500 text-xs font-bold uppercase tracking-wider">{title}</h4>{icon}</div><div className="text-2xl font-bold text-slate-800">{value}</div><div className="text-xs text-slate-400 mt-1">{sub}</div></div>); }
        function StatusBadge({ status }) { const styles = { 'On Track': 'bg-green-100 text-green-700', 'At Risk': 'bg-yellow-100 text-yellow-700', 'Off Track': 'bg-red-100 text-red-700', 'Completed': 'bg-green-100 text-green-700', 'Not Completed': 'bg-red-100 text-red-700', 'Planned': 'bg-blue-100 text-blue-700' }; return (<span className={`text-[10px] font-bold uppercase px-2 py-0.5 rounded ${styles[status] || 'bg-slate-100 text-slate-600'}`}>{status}</span>); }
        function CommentThread({ comments = [], onAdd }) { const [text, setText] = useState(''); const handleSend = () => { if (!text.trim()) return; onAdd(text); setText(''); }; return (<div className="bg-slate-50 rounded-lg border border-slate-200 flex flex-col h-[300px]"><div className="flex-1 overflow-auto p-4 space-y-4">{comments.length === 0 && <div className="text-center text-slate-400 text-sm mt-10">No comments yet. Start the thread.</div>}{comments.map((c) => { const isCEO = c.role === 'CEO'; return (<div key={c.id} className={`flex flex-col ${isCEO ? 'items-end' : 'items-start'}`}><div className={`max-w-[85%] rounded-2xl px-4 py-2 text-sm shadow-sm ${isCEO ? 'bg-purple-600 text-white rounded-br-none' : 'bg-white border border-slate-200 text-slate-700 rounded-bl-none'}`}>{c.text}</div><div className="flex items-center gap-1 mt-1 px-1"><span className="text-[10px] font-bold text-slate-500 uppercase">{c.author}</span><span className="text-[10px] text-slate-400">• {c.timestamp}</span></div></div>); })}</div><div className="p-3 bg-white border-t border-slate-200 rounded-b-lg flex gap-2"><input className="flex-1 text-sm border border-slate-200 rounded-full px-4 py-2 outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Write a reply..." value={text} onChange={(e) => setText(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSend()} /><button onClick={handleSend} className="bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-full transition-colors flex items-center justify-center shadow-sm"><Send size={16} className="ml-0.5" /></button></div></div>); }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
